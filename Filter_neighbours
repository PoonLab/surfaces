import csv
ref_seq = '/Users/sarehchimeh/Data/Human_virus_accession.txt'
Neighbours = '/Users/sarehchimeh/Data/Neighbours.txt'

def parse_accesion(file):
    """
    Loop trough table to retrieve accession numbers as a list
    """
    handle = open(file)
    accn = []
    for line in handle:
        temp = line.strip('\n')  # Remove new line
        accn.append(temp)
    return (accn)

def main():
    count = 0
    # opening the ref file as list
    ref_seq_lst = parse_accesion(ref_seq)
    with open (Neighbours, 'r') as n_file:
        title=n_file.readline()
        reader = csv.DictReader(n_file, delimiter='\t')
        columns = ['Representative','Neighbor','Host','Selected lineage','Taxonomy name','Segment name']
        for virus in ref_seq_lst:
            filepath = '/Users/sarehchimeh/Data/Neighbours/{}.txt'.format(virus)
            print(virus)
            with open(filepath, 'w') as of:
                print(filepath)
                of.write(title)
                writer = csv.DictWriter(of, fieldnames=columns, delimiter='\t')
                writer.writeheader()
                n_file.seek(0)
                next(n_file)
                for row in reader:
                    rep_lst = row['Representative'].split(',')
                    if virus in rep_lst:
                        writer.writerow(row)
                        count += 1
    print(count)

if __name__ == "__main__":
    main()
